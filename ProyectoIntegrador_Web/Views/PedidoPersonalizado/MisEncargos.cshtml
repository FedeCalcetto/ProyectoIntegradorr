@using ProyectoIntegrador.LogicaNegocio.Entidades
@using ProyectoIntegrador_Web.Models
@model MisEncargosPaginadosViewModel

<div class="container mt-4">
    <h2 class="mb-4 text-center fw-bold">Mis encargos</h2>
    @if (Model.Pedidos.Any())
    {
        foreach (var p in Model.Pedidos)
        {
            <div class="card mb-3 shadow-sm">
                <div class="card-body">
                    <h5 class="card-title">@p.Titulo</h5>
                    <p class="card-text">@p.Descripcion</p>

                    <p class="text-muted mb-2">
                        Cliente: <strong>@p.Cliente.nombre @p.Cliente.apellido</strong><br />
                        Estado: <strong>@p.Estado</strong>
                    </p>

                    @if (p.Estado == EstadoPedido.Aceptado)
                    {
                        <form asp-action="Finalizar" method="post">
                            <input type="hidden" name="id" value="@p.Id" />
                            <button class="btn btn-primary">
                                Finalizar pedido
                            </button>
                        </form>
                    }
                    else if (p.Estado == EstadoPedido.Finalizado)
                    {
                        <span class="badge bg-success">
                            Pedido finalizado
                        </span>
                    }
                </div>
            </div>
        }
    }
    else
    {
        <p class="text-center text-muted">
            Aún no aceptaste ningún encargo.
        </p>
    }

    @* 🔽 PAGINACIÓN *@
    @if (Model.TotalPaginas > 1)
    {
        <nav class="mt-4">

            <ul class="pagination justify-content-center">

                <!-- ANTERIOR -->
                <li class="page-item @(Model.PaginaActual == 1 ? "disabled" : "")">

                    <a class="page-link"
                       asp-action="MisEncargos"
                       asp-route-pagina="@(Model.PaginaActual - 1)">
                        Anterior
                    </a>

                </li>


                <!-- NÚMEROS -->
                @for (int i = 1; i <= Model.TotalPaginas; i++)
                {
                    <li class="page-item @(i == Model.PaginaActual ? "active" : "")">

                        <a class="page-link"
                           asp-action="MisEncargos"
                           asp-route-pagina="@i">
                            @i
                        </a>

                    </li>
                }


                <!-- SIGUIENTE -->
                <li class="page-item @(Model.PaginaActual == Model.TotalPaginas ? "disabled" : "")">

                    <a class="page-link"
                       asp-action="MisEncargos"
                       asp-route-pagina="@(Model.PaginaActual + 1)">
                        Siguiente
                    </a>

                </li>

            </ul>

        </nav>
    }


</div>
