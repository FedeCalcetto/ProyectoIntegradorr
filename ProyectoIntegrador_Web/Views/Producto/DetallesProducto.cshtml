@model DetallesProductoViewModel

@{
    ViewData["Title"] = "Detalle del producto";
}

<div class="container mt-5">

    <!-- Breadcrumb -->
    <nav class="mb-3">
        <small class="text-muted">
            Catálogo / @Model.SubCategoria / @Model.Nombre
        </small>
    </nav>

    <div class="row align-items-start">

        <!-- ===================== -->
        <!-- GALERÍA DE IMÁGENES -->
        <!-- ===================== -->
        <div class="col-md-5">

            <!-- Imagen principal -->
            <div class="border rounded shadow-sm p-3 mb-3 text-center bg-white">
                <img id="imagenPrincipal"
                     src="~/images/productos/@Model.Imagen"
                     class="img-fluid rounded"
                     style="max-height: 350px; object-fit: contain;"
                     alt="@Model.Nombre" />
            </div>

            <!-- Miniaturas -->
            @if (Model.Fotos != null && Model.Fotos.Any())
            {
                <div class="d-flex justify-content-center gap-2 flex-wrap">
                    @foreach (var foto in Model.Fotos)
                    {
                        <img src="~/images/productos/@foto.UrlImagen"
                             class="img-thumbnail thumb-img"
                             onclick="cambiarImagen(this)"
                             alt="Miniatura producto" />
                    }
                </div>
            }
        </div>

        <!-- ===================== -->
        <!-- INFO DEL PRODUCTO -->
        <!-- ===================== -->
        <div class="col-md-7">

            <h2 class="fw-bold mb-2">@Model.Nombre</h2>

            <p class="text-muted fs-6 lh-lg">
                @Model.Descripcion
            </p>

            <h2 class="text-success fw-bold mb-3">
                $ @Model.Precio
            </h2>

            <span class="badge rounded-pill
                bg-@(Model.Stock > 0 ? "success" : "danger") mb-3">
                @(Model.Stock > 0 ? $"Disponible ({Model.Stock})" : "Sin stock")
            </span>

            <p class="mt-3 text-muted"> Vendido por
                <strong>
                    <!--   <a asp-controller="Artesano"
                       asp-action="PerfilPublico"
                       asp-route-id="@Model.ArtesanoId"
                       class="text-decoration-none">
                        @Model.Artesano   cuando ya este lista la vista--> 
                    </a>

                    <a href="#"
                       onclick="event.preventDefault(); alert('Perfil del artesano próximamente');">
                        @Model.Artesano
                    </a>
                </strong>
            </p>

            <!-- ===================== -->
            <!-- CARRITO (PREPARADO) -->
            <!-- ===================== -->
            @if (Model.Stock > 0)
            {
                <form asp-controller="Carrito"
                      asp-action="Agregar"
                      method="post"
                      class="mt-4">

                    @Html.AntiForgeryToken()

                    <input type="hidden" name="productoId" value="@Model.Id" />

                    <div class="mb-3 w-50">
                        <label class="form-label fw-semibold">
                            Cantidad
                        </label>
                        <input type="number"
                               name="cantidad"
                               class="form-control text-center"
                               value="1"
                               min="1"
                               max="@Model.Stock" />
                    </div>

                    <button type="submit" class="btn btn-primary btn-lg shadow-sm">
                        🛒 Agregar al carrito
                    </button>
                </form>
            }
            else
            {
                <p class="text-danger fw-semibold mt-4">
                    Producto sin stock 😢
                </p>
            }
        </div>
    </div>
</div>

<!-- ===================== -->
<!-- JS -->
<!-- ===================== -->
<script>
    function cambiarImagen(element) {
        const principal = document.getElementById("imagenPrincipal");
        principal.src = element.src;

        document.querySelectorAll(".thumb-img")
            .forEach(img => img.classList.remove("active-thumb"));

        element.classList.add("active-thumb");
    }

    document.addEventListener("DOMContentLoaded", () => {
        const primera = document.querySelector(".thumb-img");
        if (primera) primera.classList.add("active-thumb");
    });
</script>

<!-- ===================== -->
<!-- JS -->
<!-- =====================
<script>
    function cambiarImagen(element) {
        const principal = document.getElementById("imagenPrincipal");
        principal.src = element.src;

        document.querySelectorAll(".thumb-img")
            .forEach(img => img.classList.remove("active-thumb"));

        element.classList.add("active-thumb");
    }

    document.addEventListener("DOMContentLoaded", () => {
        const primera = document.querySelector(".thumb-img");
        if (primera) primera.classList.add("active-thumb");
    });
</script>
 -->
