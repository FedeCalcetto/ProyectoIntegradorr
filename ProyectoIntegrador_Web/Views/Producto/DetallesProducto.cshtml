@model DetallesProductoViewModel
@{
    ViewData["Title"] = "Detalle del producto";
}

<div class="container mt-5">
    <div class="card shadow-sm p-3">

        <div class="row g-4">

            <!-- MINIATURAS -->
            <div class="col-md-1 d-flex flex-column align-items-center gap-2">
                @foreach (var foto in Model.Fotos)
                {
                    <img src="~/images/productos/@foto.UrlImagen"
                         class="img-thumbnail thumb-img"
                         style="width:60px; cursor:pointer"
                         onclick="cambiarImagen(this)" />
                }
            </div>

            <!-- IMAGEN PRINCIPAL -->
            <div class="col-md-5 text-center">
                <img id="imagenPrincipal"
                     src="~/images/productos/@Model.Imagen"
                     class="img-fluid rounded"
                     style="max-height:420px; object-fit:contain;"
                     alt="@Model.Nombre" />
            </div>

            <!-- INFO / COMPRA -->
            <div class="col-md-6">


                <h4 class="fw-semibold">
                    @Model.Nombre
                </h4>

                <p class="text-muted small mb-2">
                    @Model.Descripcion
                </p>

                <div class="mb-3">
                    <span class="fs-3 fw-bold text-dark">
                        $@Model.Precio
                    </span>
                </div>

                <span class="badge bg-@(Model.Stock > 0 ? "success" : "danger") mb-3">
                    Stock disponible:
                    @Model.Stock
                </span>

                @if (Model.Stock > 0)
                {
                    <form asp-controller="Carrito"
                          asp-action="AgregarAlCarrito"
                          method="post"
                          class="mt-3">

                        @Html.AntiForgeryToken()

                        <input type="hidden" name="productoId" value="@Model.Id" />

                        <div class="mb-3 w-50">
                            <label class="form-label small fw-semibold">
                                Cantidad
                            </label>
                            <input type="number"
                                   name="cantidad"
                                   class="form-control form-control-sm"
                                   value="1"
                                   min="1"
                                   max="@Model.Stock" />
                        </div>
                        <div class="d-flex gap-2">

                            <button type="submit"
                                    class="btn btn-primary">
                                <i class="bi bi-cart-plus"></i>
                                🛒 Agregar al carrito
                            </button>

                            <a asp-controller="Usuario"
                               asp-action="Catalogo"
                               class="btn btn-primary">
                                Volver a la tienda
                            </a>

                        </div>
                        
                    </form>
                }
                else
                {
                    <p class="text-danger fw-semibold mt-3">
                        Sin stock 😢
                    </p>
                }

            </div>

        </div>
    </div>
</div>


<!-- JS -->
<script>
    function cambiarImagen(element) {
        const principal = document.getElementById("imagenPrincipal");
        principal.src = element.src;

        document.querySelectorAll(".thumb-img")
            .forEach(img => img.classList.remove("active-thumb"));

        element.classList.add("active-thumb");
    }
</script>
