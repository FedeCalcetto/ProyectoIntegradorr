@model ProyectoIntegrador_Web.Models.RegistroUsuarioViewModel
@inject IConfiguration Configuration

@{
    Layout = "_LayoutLogin";
    ViewData["BodyClass"] = "login-body";
    ViewData["Title"] = "Registro";
}

<div class="login-wrapper">
    <div class="registro-card single">

        <!-- COLUMNA ÚNICA -->
        <div class="registro-form">
            <h6 class="brand">HechoXMí</h6>
            <h2>Crear cuenta</h2>
            <p>Completá los datos para registrarte</p>

            <form asp-controller="Login"
                  asp-action="registroUsuario"
                  method="post"
                  class="js-loader"
                  data-loader-text="Procesando...">

                <!-- Error general -->
                <div asp-validation-summary="ModelOnly"
                     class="text-danger small mb-2">
                </div>

                <div class="mb-3">
                    <input asp-for="nombre"
                           class="form-control"
                           placeholder="Nombre" />
                    <span asp-validation-for="nombre"
                          class="text-danger small"></span>
                </div>

                <div class="mb-3">
                    <input asp-for="apellido"
                           class="form-control"
                           placeholder="Apellido" />
                    <span asp-validation-for="apellido"
                          class="text-danger small"></span>
                </div>

                <div class="mb-3">
                    <input asp-for="email"
                           class="form-control"
                           placeholder="Email" />
                    <span asp-validation-for="email"
                          class="text-danger small"></span>
                </div>

                <div class="mb-3">
                    <input asp-for="password"
                           type="password"
                           class="form-control"
                           placeholder="Contraseña" />
                    <span asp-validation-for="password"
                          class="text-danger small"></span>

                    <div id="passwordHelp"
                         class="text-danger small mt-1"></div>
                </div>

                <div class="form-check registro-check mb-3">
                    <input asp-for="soyArtesano"
                           class="form-check-input"
                           id="soyArtesano" />
                    <label asp-for="soyArtesano"
                           class="form-check-label"
                           for="soyArtesano">
                        Soy artesano
                    </label>
                </div>

                <div class="d-flex justify-content-center mt-3 mb-3 recaptcha-wrapper">
                    <div class="g-recaptcha"
                         data-sitekey="@Configuration["GoogleReCaptcha:SiteKey"]">
                    </div>
                </div>

                <button type="submit"
                        class="btn btn-dark w-100">
                    Registrarme
                </button>

                <p class="mt-3 text-center">
                    ¿Ya tenés cuenta?
                    <a asp-action="Login">Iniciar sesión</a>
                </p>

                <script src="https://www.google.com/recaptcha/api.js"
                        async defer></script>
            </form>
        </div>

    </div>
</div>

@section Scripts {
    <script>
        document.addEventListener("DOMContentLoaded", () => {

            // Detectar automáticamente el input de contraseña
            const input =
                document.querySelector('input[asp-for="password"]') ||   // si existe tal cual
                document.querySelector('input[id*="password" i]') ||     // si el ID contiene "password"
                document.querySelector('input[name*="password" i]') ||   // si el name contiene "password"
                document.querySelector('input[type="password"]');        // último recurso

            const help = document.getElementById("passwordHelp");

            if (!input || !help) {
                console.warn("No se encontró el input de password.");
                return;
            }

            input.addEventListener("input", () => {
                const value = input.value;
                let errores = [];

                if (value.length < 10 || value.length > 30)
                    errores.push("• Debe tener entre 10 y 30 caracteres.");

                if (!/[A-Z]/.test(value))
                    errores.push("• Debe tener al menos una mayúscula.");

                if (!/[a-z]/.test(value))
                    errores.push("• Debe tener al menos una minúscula.");

                if (!/[0-9]/.test(value))
                    errores.push("• Debe incluir al menos un número.");

                help.innerHTML = errores.join("<br>");
            });

        });
    </script>
}